<% layout('layouts/boilerplate') %>

<h1 class="my-4">All listings</h1>
<p><a class="btn btn-sm btn-success mb-3" href="/listings/new">Create new listing</a></p>

<% if (!listings || listings.length === 0) { %>
  <div class="alert alert-secondary">No listings yet.</div>
<% } else { %>
  <div class="row g-4">
    <% listings.forEach(function(listing) { %>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100">
          <% if (listing.image && listing.image.url) { %>
            <img src="<%= listing.image.url %>" class="card-img-top" alt="<%= listing.title %>">
          <% } else { %>
            <img src="/path/to/placeholder.jpg" class="card-img-top" alt="placeholder">
          <% } %>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><a href="/listings/<%= listing._id %>"><%= listing.title || 'Untitled' %></a></h5>
            <p class="card-text text-truncate"><%= listing.description || '' %></p>
            <p class="mt-auto mb-1"><strong>Price:</strong> $<%= listing.price || 'N/A' %></p>
            <p class="text-muted small mb-0"><%= listing.location || '' %><% if (listing.country) { %>, <%= listing.country %><% } %></p>
            <a href="/listings/<%= listing._id %>" class="btn btn-primary btn-sm mt-3">View</a>
          </div>
        </div>
      </div>
    <% }); %>
  </div>
<% } %>
